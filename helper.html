<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css?v=mobile_update_v4">
    <title>Server Helper</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .card {
            border: 1px solid #ccc;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        h2 {
            margin-top: 0;
        }

        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }

        button:hover {
            background: #0056b3;
        }

        button.danger {
            background: #dc3545;
        }

        button.danger:hover {
            background: #a71d2a;
        }

        #output {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #ddd;
            white-space: pre-wrap;
            font-family: monospace;
            min-height: 100px;
        }
    </style>
</head>

<body>
    <h1>üõ†Ô∏è C√¥ng c·ª• h·ªó tr·ª£ Server</h1>

    <div class="card">
        <h2>1. Ki·ªÉm tra k·∫øt n·ªëi</h2>
        <p>Th·ª≠ l·∫•y danh s√°ch s·∫£n ph·∫©m ƒë·ªÉ xem Database ƒë√£ k·∫øt n·ªëi ch∆∞a.</p>
        <button onclick="checkHealth()">Ki·ªÉm tra API</button>
    </div>

    <div class="card">
        <h2>2. Kh·ªüi t·∫°o d·ªØ li·ªáu (Seed)</h2>
        <p>N·∫øu Database k·∫øt n·ªëi ƒë∆∞·ª£c nh∆∞ng Menu tr·ªëng, h√£y b·∫•m n√∫t n√†y ƒë·ªÉ t·∫°o d·ªØ li·ªáu m·∫´u.</p>
        <button class="danger" onclick="seedData()">T·∫°o d·ªØ li·ªáu m·∫´u</button>
    </div>

    <div class="card">
        <h2>3. Ki·ªÉm tra IP Server</h2>
        <p>Xem ƒë·ªãa ch·ªâ IP m√† Server ƒëang d√πng ƒë·ªÉ k·∫øt n·ªëi ra ngo√†i (d√πng ƒë·ªÉ Whitelist tr√™n MongoDB Atlas).</p>
        <button onclick="checkServerIP()">Xem IP Server</button>
    </div>

    <h3>K·∫øt qu·∫£:</h3>
    <div id="output">Ch∆∞a c√≥ h√†nh ƒë·ªông n√†o...</div>

    <script>
        const output = document.getElementById('output');

        function log(msg, isError = false) {
            output.innerHTML = msg;
            output.style.color = isError ? 'red' : 'green';
            if (!isError) output.style.color = '#333';
        }

        async function checkServerIP() {
            log("ƒêang l·∫•y IP Server...");
            try {
                const res = await fetch('/server-ip');
                const text = await res.text();
                if (res.ok) {
                    log(`‚úÖ IP C·ª¶A SERVER L√Ä:\n\n${text}\n\nüëâ H√£y copy IP n√†y v√† th√™m v√†o 'Network Access' tr√™n MongoDB Atlas (IP Whitelist).`);
                } else {
                    log(`‚ùå Kh√¥ng l·∫•y ƒë∆∞·ª£c IP: ${text}`, true);
                }
            } catch (err) {
                log(`‚ùå L·ªói k·∫øt n·ªëi: ${err.message}`, true);
            }
        }

        async function checkHealth() {
            log("ƒêang ki·ªÉm tra k·∫øt n·ªëi t·ªõi /products...");
            try {
                const res = await fetch('/products');
                const text = await res.text();

                if (res.ok) {
                    try {
                        const json = JSON.parse(text);
                        log(`‚úÖ TH√ÄNH C√îNG!\nServer ph·∫£n h·ªìi t·ªët.\nS·ªë l∆∞·ª£ng m√≥n ƒÉn: ${json.length}\n\nD·ªØ li·ªáu:\n${JSON.stringify(json, null, 2)}`);
                    } catch (e) {
                        log(`‚úÖ Server ph·∫£n h·ªìi (Text), nh∆∞ng kh√¥ng ph·∫£i JSON:\n${text}`);
                    }
                } else {
                    log(`‚ùå L·ªñI SERVER (${res.status}):\n${text}`, true);
                }
            } catch (err) {
                log(`‚ùå L·ªñI K·∫æT N·ªêI: ${err.message}`, true);
            }
        }

        async function seedData() {
            if (!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a d·ªØ li·ªáu c≈© v√† t·∫°o l·∫°i d·ªØ li·ªáu m·∫´u kh√¥ng?")) return;

            log("ƒêang g·ª≠i l·ªánh t·∫°o d·ªØ li·ªáu (POST /products/seed)...");
            try {
                const res = await fetch('/products/seed', { method: 'POST' });
                const text = await res.text();

                if (res.ok) {
                    log(`‚úÖ ƒê√É T·∫†O D·ªÆ LI·ªÜU TH√ÄNH C√îNG!\n\nK·∫øt qu·∫£:\n${text}`);
                } else {
                    log(`‚ùå T·∫†O D·ªÆ LI·ªÜU TH·∫§T B·∫†I (${res.status}):\n${text}`, true);
                }
            } catch (err) {
                log(`‚ùå L·ªñI K·∫æT N·ªêI: ${err.message}`, true);
            }
        }
    </script>
</body>

</html>